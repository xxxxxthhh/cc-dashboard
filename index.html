<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wheel Strategy Dashboard</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0e14;--card:#12171f;--border:#1e2733;--text:#c9d1d9;--dim:#6e7681;--green:#3fb950;--red:#f85149;--blue:#58a6ff;--yellow:#d29922;--purple:#bc8cff;--cyan:#39d2c0;--green-bg:rgba(63,185,80,.1);--red-bg:rgba(248,81,73,.1);--blue-bg:rgba(88,166,255,.1);--yellow-bg:rgba(210,153,34,.1);--purple-bg:rgba(188,140,255,.1);--cyan-bg:rgba(57,210,192,.1)}
body{background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,'SF Pro Display','Segoe UI',sans-serif;padding:20px;max-width:1200px;margin:0 auto;line-height:1.5}
#lock-screen{display:flex;flex-direction:column;align-items:center;justify-content:center;height:80vh;animation:fadeIn .5s}
#lock-screen h1{font-size:56px;margin-bottom:24px}
#lock-screen input{background:var(--card);border:2px solid var(--border);border-radius:12px;color:var(--text);font-size:28px;padding:14px 24px;width:200px;text-align:center;letter-spacing:10px;outline:none;transition:border-color .2s}
#lock-screen input:focus{border-color:var(--blue)}
#lock-screen .error{color:var(--red);font-size:13px;margin-top:8px;height:20px}
#dashboard{display:none;animation:fadeIn .6s}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

/* Header */
.header{margin-bottom:28px}
.header h1{font-size:26px;font-weight:700;background:linear-gradient(135deg,var(--blue),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;display:inline}
.header .sub{color:var(--dim);font-size:13px;margin-top:4px}

/* Nav tabs */
.nav{display:flex;gap:4px;margin-bottom:24px;border-bottom:1px solid var(--border);padding-bottom:0;overflow-x:auto}
.nav button{background:none;border:none;color:var(--dim);font-size:13px;padding:10px 16px;cursor:pointer;border-bottom:2px solid transparent;transition:all .2s;white-space:nowrap}
.nav button:hover{color:var(--text)}
.nav button.active{color:var(--blue);border-bottom-color:var(--blue)}

/* Sections */
.section{display:none}.section.active{display:block;animation:fadeIn .3s}

/* Summary grid */
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;margin-bottom:24px}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;transition:transform .15s,border-color .15s}
.card:hover{transform:translateY(-2px);border-color:rgba(88,166,255,.3)}
.card .label{color:var(--dim);font-size:11px;text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px}
.card .value{font-size:22px;font-weight:700}
.card .sub-value{font-size:11px;color:var(--dim);margin-top:2px}
.green{color:var(--green)}.red{color:var(--red)}.blue{color:var(--blue)}.yellow{color:var(--yellow)}.purple{color:var(--purple)}.cyan{color:var(--cyan)}

/* Tables */
table{width:100%;border-collapse:collapse;background:var(--card);border:1px solid var(--border);border-radius:12px;overflow:hidden;margin-bottom:16px;font-size:13px}
th{background:rgba(30,39,51,.8);color:var(--dim);font-size:11px;text-transform:uppercase;letter-spacing:.5px;padding:10px 14px;text-align:left;font-weight:600}
td{padding:10px 14px;border-top:1px solid var(--border)}
tr:hover{background:rgba(88,166,255,.03)}
.ticker{font-weight:700;color:var(--text)}

/* Tags */
.tag{display:inline-block;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:600}
.tag-green{background:var(--green-bg);color:var(--green)}
.tag-red{background:var(--red-bg);color:var(--red)}
.tag-blue{background:var(--blue-bg);color:var(--blue)}
.tag-yellow{background:var(--yellow-bg);color:var(--yellow)}
.tag-purple{background:var(--purple-bg);color:var(--purple)}
.tag-cyan{background:var(--cyan-bg);color:var(--cyan)}
.tag-dim{background:rgba(110,118,129,.1);color:var(--dim)}

/* DTE bar */
.dte-bar{width:100%;height:4px;background:var(--border);border-radius:2px;overflow:hidden;margin-top:4px}
.dte-fill{height:100%;border-radius:2px;transition:width .3s}

/* Wheel tracker */
.wheel-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px;margin-bottom:24px}
.wheel-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;position:relative;overflow:hidden}
.wheel-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px}
.wheel-card.phase-csp::before{background:linear-gradient(90deg,var(--purple),var(--blue))}
.wheel-card.phase-cc::before{background:linear-gradient(90deg,var(--green),var(--cyan))}
.wheel-card.phase-cc-exit::before{background:linear-gradient(90deg,var(--yellow),var(--red))}
.wheel-card.phase-cc-locked::before{background:linear-gradient(90deg,var(--red),var(--yellow))}
.wheel-card .wc-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.wheel-card .wc-ticker{font-size:18px;font-weight:700}
.wheel-card .wc-detail{color:var(--dim);font-size:12px}
.wheel-card .wc-note{font-size:12px;margin-top:4px}

/* Phase flow */
.phase-flow{display:flex;align-items:center;gap:6px;margin:20px 0}
.phase-step{padding:6px 14px;border-radius:20px;font-size:12px;font-weight:600;opacity:.3}
.phase-step.active{opacity:1}
.phase-step.step-csp{background:var(--purple-bg);color:var(--purple)}
.phase-step.step-assign{background:var(--yellow-bg);color:var(--yellow)}
.phase-step.step-cc{background:var(--green-bg);color:var(--green)}
.phase-arrow{color:var(--dim);font-size:10px;opacity:.4}

/* Section headers */
.sh{display:flex;align-items:center;gap:10px;margin:28px 0 14px;padding-bottom:10px;border-bottom:1px solid var(--border)}
.sh h2{font-size:15px;font-weight:600;color:var(--text)}
.sh .count{font-size:12px;color:var(--dim);background:var(--border);padding:2px 8px;border-radius:10px}

/* Opt changes */
.opt-item{display:flex;align-items:center;gap:10px;padding:8px 0;font-size:13px;border-bottom:1px solid var(--border)}
.opt-item:last-child{border-bottom:none}
.opt-badge{padding:3px 10px;border-radius:20px;font-size:11px;font-weight:600;min-width:56px;text-align:center}
.opt-badge.done{background:var(--green-bg);color:var(--green)}
.opt-badge.active{background:var(--blue-bg);color:var(--blue)}
.opt-badge.pending{background:var(--yellow-bg);color:var(--yellow)}

/* Compare */
.compare{display:grid;grid-template-columns:1fr 50px 1fr;gap:0;margin:20px 0}
.compare-box{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:24px;text-align:center}
.compare-arrow{display:flex;align-items:center;justify-content:center;font-size:24px;color:var(--blue)}
.compare-box .big{font-size:30px;font-weight:700;margin:8px 0}
.compare-box .sub{color:var(--dim);font-size:12px}

/* Note */
.note-box{background:var(--card);border-left:3px solid var(--yellow);padding:12px 16px;margin:16px 0;font-size:13px;color:var(--yellow);border-radius:0 12px 12px 0}

/* Responsive */
@media(max-width:640px){
  body{padding:12px}
  .grid{grid-template-columns:repeat(2,1fr);gap:8px}
  .card .value{font-size:18px}
  .wheel-grid{grid-template-columns:1fr}
  table{font-size:12px}
  th,td{padding:8px 10px}
  .compare{grid-template-columns:1fr;gap:8px}
  .compare-arrow{transform:rotate(90deg)}
}
</style>
</head>
<body>

<div id="lock-screen">
<h1>ğŸ”’</h1>
<input type="password" id="pwd" maxlength="4" placeholder="Â·Â·Â·Â·" autofocus>
<div class="error" id="pwd-error"></div>
</div>

<div id="dashboard">
<div class="header">
<h1>ğŸ´ Wheel Strategy Dashboard</h1>
<p class="sub">Theta Gang æ”¶ç§Ÿè¿½è¸ª Â· <span id="update-date">â€”</span></p>
</div>

<div class="nav" id="nav">
<button class="active" data-tab="overview">æ€»è§ˆ</button>
<button data-tab="wheel">Wheel è¿½è¸ª</button>
<button data-tab="cc">Covered Calls</button>
<button data-tab="csp">Cash-Secured Puts</button>
<button data-tab="closed">å·²å®ç°æ”¶ç›Š</button>
<button data-tab="idle">é—²ç½®ä»“ä½</button>
<button data-tab="optimize">ä¼˜åŒ–æ–¹æ¡ˆ</button>
</div>

<!-- Overview -->
<div class="section active" id="tab-overview">
<div class="grid" id="summary-cards"></div>
<div class="sh"><h2>ğŸ”„ Wheel çŠ¶æ€ä¸€è§ˆ</h2></div>
<div class="wheel-grid" id="wheel-overview"></div>
</div>

<!-- Wheel Tracker -->
<div class="section" id="tab-wheel">
<div class="phase-flow">
<div class="phase-step step-csp">Sell Put</div><div class="phase-arrow">â†’</div>
<div class="phase-step step-assign">Assign æ¥è‚¡</div><div class="phase-arrow">â†’</div>
<div class="phase-step step-cc">Sell Call</div><div class="phase-arrow">â†’</div>
<div class="phase-step step-assign">Assign å‡ºè‚¡</div><div class="phase-arrow">â†’</div>
<div class="phase-step step-csp">Sell Put â™»ï¸</div>
</div>
<div class="wheel-grid" id="wheel-cards"></div>
</div>

<!-- CC -->
<div class="section" id="tab-cc">
<div class="sh"><h2>ğŸ“Š Covered Call æŒä»“</h2><span class="count" id="cc-count">0</span></div>
<table id="cc-table"><thead><tr>
<th>æ ‡çš„</th><th>Strike</th><th>å¼€ä»“</th><th>åˆ°æœŸ</th><th>DTE</th><th>æƒåˆ©é‡‘</th><th>æˆæœ¬</th><th>æ”¶ç›Šç‡</th><th>å¹´åŒ–</th><th>çŠ¶æ€</th>
</tr></thead><tbody></tbody></table>
</div>

<!-- CSP -->
<div class="section" id="tab-csp">
<div class="sh"><h2>ğŸ’ Cash-Secured Put æŒä»“</h2><span class="count" id="csp-count">0</span></div>
<table id="csp-table"><thead><tr>
<th>æ ‡çš„</th><th>Strike</th><th>å¼€ä»“</th><th>åˆ°æœŸ</th><th>DTE</th><th>æƒåˆ©é‡‘</th><th>ä¿è¯é‡‘</th><th>æ”¶ç›Šç‡</th><th>å¹´åŒ–</th><th>çŠ¶æ€</th>
</tr></thead><tbody></tbody></table>
</div>

<!-- Closed -->
<div class="section" id="tab-closed">
<div class="grid" id="realized-cards"></div>
<div class="sh"><h2>ğŸ’° å·²å¹³ä»“è®°å½•</h2><span class="count" id="closed-count">0</span></div>
<table id="closed-table"><thead><tr>
<th>æ ‡çš„</th><th>ç±»å‹</th><th>Strike</th><th>å¼€ä»“</th><th>å¹³ä»“</th><th>å¤©æ•°</th><th>æƒåˆ©é‡‘</th><th>ç»“æœ</th>
</tr></thead><tbody></tbody></table>
</div>

<!-- Idle -->
<div class="section" id="tab-idle">
<div class="sh"><h2>ğŸ’¤ æœªå¼€ä»“ä½ï¼ˆé—²ç½®èµ„é‡‘ï¼‰</h2></div>
<table id="idle-table"><thead><tr>
<th>æ ‡çš„</th><th>è‚¡æ•°</th><th>å‡ä»·</th><th>å¸‚å€¼</th><th>å¯å¼€CC</th><th>å¤‡æ³¨</th>
</tr></thead><tbody></tbody></table>
</div>

<!-- Optimize -->
<div class="section" id="tab-optimize">
<div class="note-box">é›†ä¸­åˆ°é«˜ IV æ ‡çš„ï¼Œæœ€å¤§åŒ– Wheel æ”¶ç§Ÿæ•ˆç‡ã€‚çŸ­å‘¨æœŸ 5-7 DTE ä¼˜å…ˆã€‚</div>
<div class="sh"><h2>ğŸ”„ æ“ä½œè¿›åº¦</h2></div>
<div id="opt-changes" style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px 16px;margin-bottom:24px"></div>
<div class="sh"><h2>ğŸ“ˆ å½“å‰ vs ä¼˜åŒ–å</h2></div>
<div class="compare">
<div class="compare-box"><div class="sub">å½“å‰å¹´åŒ–æ”¶å…¥</div><div class="big yellow" id="cur-income">â€”</div><div class="sub" id="cur-yield">â€”</div></div>
<div class="compare-arrow">â†’</div>
<div class="compare-box"><div class="sub">ä¼˜åŒ–åå¹´åŒ–æ”¶å…¥</div><div class="big green" id="opt-income">â€”</div><div class="sub" id="opt-yield">â€”</div></div>
</div>
</div>
</div>

<script>
const ENC = {"salt":"ibTeqk4LeSxk7FeqnFcp+Q==","iv":"STR6xsADraGsbTvL","tag":"UAYyvC9tRgpsYucYcVXYEQ==","data":"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"};

function b64(s){return Uint8Array.from(atob(s),c=>c.charCodeAt(0))}

async function decrypt(pwd){
  const enc=new TextEncoder();
  const km=await crypto.subtle.importKey('raw',enc.encode(pwd),{name:'PBKDF2'},false,['deriveKey']);
  const key=await crypto.subtle.deriveKey({name:'PBKDF2',salt:b64(ENC.salt),iterations:100000,hash:'SHA-256'},km,{name:'AES-GCM',length:256},false,['decrypt']);
  const ct=b64(ENC.data),tag=b64(ENC.tag);
  const combined=new Uint8Array(ct.length+tag.length);
  combined.set(ct);combined.set(tag,ct.length);
  return JSON.parse(new TextDecoder().decode(await crypto.subtle.decrypt({name:'AES-GCM',iv:b64(ENC.iv)},key,combined)));
}

document.getElementById('pwd').addEventListener('input',async function(){
  if(this.value.length===4){
    try{
      const data=await decrypt(this.value);
      document.getElementById('lock-screen').style.display='none';
      document.getElementById('dashboard').style.display='block';
      render(data);
    }catch(e){
      document.getElementById('pwd-error').textContent='å¯†ç é”™è¯¯';
      this.value='';
    }
  }
});

// Tab navigation
document.getElementById('nav').addEventListener('click',e=>{
  if(e.target.tagName!=='BUTTON')return;
  document.querySelectorAll('.nav button').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  e.target.classList.add('active');
  document.getElementById('tab-'+e.target.dataset.tab).classList.add('active');
});

const fmt=n=>'$'+n.toLocaleString('en-US',{minimumFractionDigits:0,maximumFractionDigits:0});
const fmtPct=n=>n.toFixed(1)+'%';
const days=(a,b)=>Math.round((new Date(b)-new Date(a))/864e5);

function dteTag(dte,total){
  const pct=Math.max(0,Math.min(100,(1-dte/total)*100));
  let color=dte<=3?'var(--red)':dte<=7?'var(--yellow)':'var(--green)';
  return `<div>${dte}å¤©</div><div class="dte-bar"><div class="dte-fill" style="width:${pct}%;background:${color}"></div></div>`;
}

function statusTag(text,type){return `<span class="tag tag-${type}">${text}</span>`}

function render(D){
  const today=D.updatedAt;
  document.getElementById('update-date').textContent=today;

  // === Summary ===
  let totalCCPremium=0,totalCSPPremium=0,totalRealized=0,totalCCCost=0,totalCSPCollateral=0,totalIdleCost=0;
  D.ccPositions.forEach(p=>{totalCCPremium+=p.premium;totalCCCost+=p.costPerShare*100});
  D.cspPositions.forEach(p=>{totalCSPPremium+=p.premium;totalCSPCollateral+=p.collateral});
  D.closedTrades.forEach(t=>totalRealized+=t.premium);
  D.idlePositions.forEach(p=>totalIdleCost+=p.shares*p.cost);

  const activePremium=totalCCPremium+totalCSPPremium;
  const totalCap=totalCCCost+totalCSPCollateral+totalIdleCost;
  const daysYTD=days('2026-01-01',today);
  const annRealized=daysYTD>0?totalRealized*(365/daysYTD):0;

  const cards=[
    {label:'æ´»è·ƒæƒåˆ©é‡‘',value:fmt(Math.round(activePremium)),cls:'green',sub:`CC ${fmt(Math.round(totalCCPremium))} + CSP ${fmt(Math.round(totalCSPPremium))}`},
    {label:'YTD å·²å®ç°',value:fmt(Math.round(totalRealized)),cls:'green',sub:`${D.closedTrades.length}ç¬” Â· å¹´åŒ–æ¨ç®— ${fmt(Math.round(annRealized))}`},
    {label:'æ´»è·ƒCC',value:D.ccPositions.length+'å¼ ',cls:'cyan',sub:fmt(Math.round(totalCCCost))+' è¦†ç›–'},
    {label:'æ´»è·ƒCSP',value:D.cspPositions.length+'å¼ ',cls:'purple',sub:fmt(Math.round(totalCSPCollateral))+' ä¿è¯é‡‘'},
    {label:'Wheel æ ‡çš„',value:D.wheelCycles.length+'ä¸ª',cls:'blue',sub:'CSP '+D.wheelCycles.filter(w=>w.phase==='csp').length+' Â· CC '+D.wheelCycles.filter(w=>w.phase.startsWith('cc')).length},
    {label:'é—²ç½®èµ„é‡‘',value:fmt(Math.round(totalIdleCost)),cls:'yellow',sub:D.idlePositions.length+'ä¸ªä»“ä½'}
  ];
  const sc=document.getElementById('summary-cards');
  cards.forEach(c=>{
    const d=document.createElement('div');d.className='card';
    d.innerHTML=`<div class="label">${c.label}</div><div class="value ${c.cls}">${c.value}</div><div class="sub-value">${c.sub||''}</div>`;
    sc.appendChild(d);
  });

  // === Wheel Overview (on overview tab) ===
  renderWheelCards(D.wheelCycles,'wheel-overview');

  // === Wheel Tracker tab ===
  renderWheelCards(D.wheelCycles,'wheel-cards');

  // === CC Table ===
  document.getElementById('cc-count').textContent=D.ccPositions.length+'å¼ ';
  const ccTb=document.querySelector('#cc-table tbody');
  D.ccPositions.forEach(p=>{
    const totalDte=days(p.sellDate,p.expiry);
    const dte=days(today,p.expiry);
    const cost100=p.costPerShare*100;
    const yPer=(p.premium/cost100)*100;
    const ann=totalDte>0?yPer*(365/totalDte):0;
    let st,sc2;
    if(dte<=0){st='å·²åˆ°æœŸ';sc2='dim'}
    else if(dte<=3){st='âš ï¸ å³å°†åˆ°æœŸ';sc2='yellow'}
    else if(ann>30){st='é«˜æ”¶ç›Š';sc2='green'}
    else if(ann>15){st='æ­£å¸¸';sc2='green'}
    else{st='åä½';sc2='yellow'}
    const tr=document.createElement('tr');
    tr.innerHTML=`<td class="ticker">${p.ticker}</td><td>$${p.strike}</td><td>${p.sellDate.slice(5)}</td><td>${p.expiry.slice(5)}</td><td>${dteTag(Math.max(0,dte),totalDte)}</td><td class="green">${fmt(p.premium)}</td><td>${fmt(Math.round(cost100))}</td><td>${fmtPct(yPer)}</td><td><strong>${fmtPct(ann)}</strong></td><td>${statusTag(st,sc2)}</td>`;
    ccTb.appendChild(tr);
  });

  // === CSP Table ===
  document.getElementById('csp-count').textContent=D.cspPositions.length+'å¼ ';
  const cspTb=document.querySelector('#csp-table tbody');
  D.cspPositions.forEach(p=>{
    const totalDte=days(p.sellDate,p.expiry);
    const dte=days(today,p.expiry);
    const yPer=(p.premium/p.collateral)*100;
    const ann=totalDte>0?yPer*(365/totalDte):0;
    let st,sc2;
    if(dte<=0){st='å·²åˆ°æœŸ';sc2='dim'}
    else if(dte<=3){st='âš ï¸ å³å°†åˆ°æœŸ';sc2='yellow'}
    else if(ann>30){st='é«˜æ”¶ç›Š';sc2='purple'}
    else{st='æ­£å¸¸';sc2='green'}
    const tr=document.createElement('tr');
    tr.innerHTML=`<td class="ticker">${p.ticker}</td><td>$${p.strike}</td><td>${p.sellDate.slice(5)}</td><td>${p.expiry.slice(5)}</td><td>${dteTag(Math.max(0,dte),totalDte)}</td><td class="green">${fmt(p.premium)}</td><td>${fmt(p.collateral)}</td><td>${fmtPct(yPer)}</td><td><strong>${fmtPct(ann)}</strong></td><td>${statusTag(st,sc2)}</td>`;
    cspTb.appendChild(tr);
  });

  // === Closed Trades ===
  document.getElementById('closed-count').textContent=D.closedTrades.length+'ç¬”';
  const rCards=[
    {label:'YTD å·²å®ç°æ”¶ç›Š',value:fmt(Math.round(totalRealized)),cls:'green'},
    {label:'å·²å¹³ä»“ç¬”æ•°',value:D.closedTrades.length+'ç¬”',cls:'blue'},
    {label:'å¹´åŒ–æ¨ç®—',value:fmt(Math.round(annRealized)),cls:'green'}
  ];
  const rc=document.getElementById('realized-cards');
  rCards.forEach(c=>{
    const d=document.createElement('div');d.className='card';
    d.innerHTML=`<div class="label">${c.label}</div><div class="value ${c.cls}">${c.value}</div>`;
    rc.appendChild(d);
  });
  const ctb=document.querySelector('#closed-table tbody');
  D.closedTrades.forEach(t=>{
    const d=days(t.openDate,t.closeDate);
    const tr=document.createElement('tr');
    tr.innerHTML=`<td class="ticker">${t.ticker}</td><td>${statusTag(t.type,t.type==='CC'?'cyan':'purple')}</td><td>$${t.strike}</td><td>${t.openDate.slice(5)}</td><td>${t.closeDate.slice(5)}</td><td>${d}å¤©</td><td class="green">${fmt(t.premium)}</td><td>${statusTag(t.assigned?'è¢«Assign':'åˆ°æœŸå½’é›¶',t.assigned?'yellow':'green')}</td>`;
    ctb.appendChild(tr);
  });

  // === Idle ===
  const itb=document.querySelector('#idle-table tbody');
  D.idlePositions.forEach(p=>{
    const mv=p.shares*p.cost;
    const tr=document.createElement('tr');
    tr.innerHTML=`<td class="ticker">${p.ticker}</td><td>${p.shares}</td><td>$${p.cost}</td><td>${fmt(Math.round(mv))}</td><td>${p.canCC?statusTag('å¯ä»¥','green'):statusTag('ä¸è¶³100è‚¡','red')}</td><td style="color:var(--dim)">${p.note}</td>`;
    itb.appendChild(tr);
  });

  // === Optimize ===
  const oc=document.getElementById('opt-changes');
  D.optChanges.forEach(c=>{
    const d=document.createElement('div');d.className='opt-item';
    d.innerHTML=`<span class="opt-badge ${c.cls}">${c.action}</span><span>${c.detail}</span>`;
    oc.appendChild(d);
  });

  // Compare
  const ccAnnual=D.ccPositions.reduce((s,p)=>{const d=days(p.sellDate,p.expiry);return s+(d>0?(p.premium/d)*365:0)},0);
  const cspAnnual=D.cspPositions.reduce((s,p)=>{const d=days(p.sellDate,p.expiry);return s+(d>0?(p.premium/d)*365:0)},0);
  const curIncome=Math.round(ccAnnual+cspAnnual);
  const curYield=totalCap>0?(curIncome/totalCap*100):0;
  const optAI=D.optEstimates.reduce((s,e)=>s+e.monthlyPremium*12,0);
  const optTC=D.optEstimates.reduce((s,e)=>s+e.cost,0);
  document.getElementById('cur-income').textContent=fmt(curIncome);
  document.getElementById('cur-yield').textContent='ç»„åˆå¹´åŒ– '+fmtPct(curYield);
  document.getElementById('opt-income').textContent=fmt(optAI);
  document.getElementById('opt-yield').textContent='ç»„åˆå¹´åŒ– '+fmtPct(optTC>0?optAI/optTC*100:0);
}

function renderWheelCards(cycles,containerId){
  const container=document.getElementById(containerId);
  cycles.forEach(w=>{
    const d=document.createElement('div');
    d.className=`wheel-card phase-${w.phase}`;
    const phaseLabel={csp:'Sell Put',cc:'Sell Call','cc-exit':'æ¸…é€€ä¸­','cc-locked':'è¿œæœŸé”å®š'}[w.phase]||w.phase;
    const phaseTag={csp:'purple',cc:'green','cc-exit':'yellow','cc-locked':'red'}[w.phase]||'dim';
    d.innerHTML=`
      <div class="wc-header">
        <span class="wc-ticker">${w.ticker}</span>
        ${statusTag(phaseLabel,phaseTag)}
      </div>
      <div class="wc-detail">${w.detail}</div>
      <div class="wc-note" style="color:var(--dim)">${w.note}</div>
    `;
    container.appendChild(d);
  });
}
</script>
</body>
</html>
